---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';
import ThemeToggle from './ThemeToggle.astro';

const currentPath = Astro.url.pathname;
---

<header>
	<a href="#main" class="skip-link">Skip to main</a>
	<nav>
		<div class="internal-links header-title">
			<a href="/">{SITE_TITLE}</a>
		</div>
		<div class="internal-links desktop-nav">
			<div class="dropdown">
				<button aria-controls="dropdown-performance" aria-expanded="false" class={`dropbtn ${['/harmony', '/blacksmith'].includes(currentPath) ? 'active' : ''}`}>Performance &darr;</button>
				<ul id="dropdown-performance" class="dropdown-content">
					<li><HeaderLink href="/harmony">&middot; Harmony</HeaderLink></li>
					<li><HeaderLink href="/blacksmith">&middot; Blacksmith</HeaderLink></li>
				</ul>
			</div>
			<div class="dropdown">
				<button aria-controls="dropdown-game_related" aria-expanded="false" class={`dropbtn ${['/portalmodpack', '/bioshockmodpack'].includes(currentPath) ? 'active' : ''}`}>Game-related &darr;</button>
				<div id="dropdown-game_related" class="dropdown-content">
					<li><HeaderLink href="/portalmodpack">&middot; PortalMP</HeaderLink></li>
					<li><HeaderLink href="/bioshockmodpack">&middot; BioshockMP</HeaderLink></li>
				</div>
			</div>
			<div class="dropdown">
				<button aria-controls="dropdown-misc" aria-expanded="false" class={`dropbtn ${[ '/glowlichenfix', '/excalibur'].includes(currentPath) ? 'active' : ''}`}>Miscellaneous &darr;</button>
				<div id="dropdown-misc" class="dropdown-content">
					<li><HeaderLink href="/glowlichenfix">&middot; GlowLichenFix</HeaderLink></li>
					<li><HeaderLink href="/excalibur">&middot; Excalibur</HeaderLink></li>
				</div>
			</div>
		</div>
		
		<button class="mobile-menu-btn" id="mobile-menu-btn">
			<span class="hamburger-line"></span>
			<span class="hamburger-line"></span>
			<span class="hamburger-line"></span>
		</button>
		
		<div class="social-links">
			<ThemeToggle />
			<a href="https://ko-fi.com/ceilingash">
				<span class="sr-only">Ko-Fi</span>
				<svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32">
					<path fill="currentColor" d="M11.351 2.715c-2.7 0-4.986.025-6.83.26C2.078 3.285 0 5.154 0 8.61c0 3.506.182 6.13 1.585 8.493 1.584 2.701 4.233 4.182 7.662 4.182h.83c4.209 0 6.494-2.234 7.637-4a9.5 9.5 0 0 0 1.091-2.338C21.792 14.688 24 12.22 24 9.208v-.415c0-3.247-2.13-5.507-5.792-5.87-1.558-.156-2.65-.208-6.857-.208m0 1.947c4.208 0 5.09.052 6.571.182 2.624.311 4.13 1.584 4.13 4v.39c0 2.156-1.792 3.844-3.87 3.844h-.935l-.156.649c-.208 1.013-.597 1.818-1.039 2.546-.909 1.428-2.545 3.064-5.922 3.064h-.805c-2.571 0-4.831-.883-6.078-3.195-1.09-2-1.298-4.155-1.298-7.506 0-2.181.857-3.402 3.012-3.714 1.533-.233 3.559-.26 6.39-.26m6.547 2.287c-.416 0-.65.234-.65.546v2.935c0 .311.234.545.65.545 1.324 0 2.051-.754 2.051-2s-.727-2.026-2.052-2.026m-10.39.182c-1.818 0-3.013 1.48-3.013 3.142 0 1.533.858 2.857 1.949 3.897.727.701 1.87 1.429 2.649 1.896a1.47 1.47 0 0 0 1.507 0c.78-.467 1.922-1.195 2.623-1.896 1.117-1.039 1.974-2.364 1.974-3.897 0-1.662-1.247-3.142-3.039-3.142-1.065 0-1.792.545-2.338 1.298-.493-.753-1.246-1.298-2.312-1.298"/>
				</svg>
			</a>
			<a href="https://x.com/ceilingash">
				<span class="sr-only">X</span>
				<svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32">
					<path fill="currentColor" d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/>
				</svg>
			</a>
			<a href="https://modrinth.com/user/ceilingash">
				<span class="sr-only">Modrinth</span>
				<svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32">
					<path fill="currentColor" d="M12.252.004a11.78 11.768 0 0 0-8.92 3.73 11 10.999 0 0 0-2.17 3.11 11.37 11.359 0 0 0-1.16 5.169c0 1.42.17 2.5.6 3.77.24.759.77 1.899 1.17 2.529a12.3 12.298 0 0 0 8.85 5.639c.44.05 2.54.07 2.76.02.2-.04.22.1-.26-1.7l-.36-1.37-1.01-.06a8.5 8.489 0 0 1-5.18-1.8 5.34 5.34 0 0 1-1.3-1.26c0-.05.34-.28.74-.5a37.572 37.545 0 0 1 2.88-1.629c.03 0 .5.45 1.06.98l1 .97 2.07-.43 2.06-.43 1.47-1.47c.8-.8 1.48-1.5 1.48-1.52 0-.09-.42-1.63-.46-1.7-.04-.06-.2-.03-1.02.18-.53.13-1.2.3-1.45.4l-.48.15-.53.53-.53.53-.93.1-.93.07-.52-.5a2.7 2.7 0 0 1-.96-1.7l-.13-.6.43-.57c.68-.9.68-.9 1.46-1.1.4-.1.65-.2.83-.33.13-.099.65-.579 1.14-1.069l.9-.9-.7-.7-.7-.7-1.95.54c-1.07.3-1.96.53-1.97.53-.03 0-2.23 2.48-2.63 2.97l-.29.35.28 1.03c.16.56.3 1.16.31 1.34l.03.3-.34.23c-.37.23-2.22 1.3-2.84 1.63-.36.2-.37.2-.44.1-.08-.1-.23-.6-.32-1.03-.18-.86-.17-2.75.02-3.73a8.84 8.839 0 0 1 7.9-6.93c.43-.03.77-.08.78-.1.06-.17.5-2.999.47-3.039-.01-.02-.1-.02-.2-.03Zm3.68.67c-.2 0-.3.1-.37.38-.06.23-.46 2.42-.46 2.52 0 .04.1.11.22.16a8.51 8.499 0 0 1 2.99 2 8.38 8.379 0 0 1 2.16 3.449 6.9 6.9 0 0 1 .4 2.8c0 1.07 0 1.27-.1 1.73a9.37 9.369 0 0 1-1.76 3.769c-.32.4-.98 1.06-1.37 1.38-.38.32-1.54 1.1-1.7 1.14-.1.03-.1.06-.07.26.03.18.64 2.56.7 2.78l.06.06a12.07 12.058 0 0 0 7.27-9.4c.13-.77.13-2.58 0-3.4a11.96 11.948 0 0 0-5.73-8.578c-.7-.42-2.05-1.06-2.25-1.06Z"/>
				</svg>
			</a>
			<a href="https://linktr.ee/ceilingash">
				<span class="sr-only">Linktree</span>
				<svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32">
					<path fill="currentColor" d="m13.73635 5.85251 4.00467-4.11665 2.3248 2.3808-4.20064 4.00466h5.9085v3.30473h-5.9365l4.22865 4.10766-2.3248 2.3338L12.0005 12.099l-5.74052 5.76852-2.3248-2.3248 4.22864-4.10766h-5.9375V8.12132h5.9085L3.93417 4.11666l2.3248-2.3808 4.00468 4.11665V0h3.4727zm-3.4727 10.30614h3.4727V24h-3.4727z"/>
				</svg>
			</a>
		</div>
	</nav>
	
	<div class="mobile-menu" id="mobile-menu">
		<div class="mobile-menu-content">
			<div class="mobile-links">
				<div class="mobile-section">
					<HeaderLink href="/">&middot; Home</HeaderLink>
				</div>
				<div class="mobile-section">
					<h3>Performance</h3>
					<HeaderLink href="/harmony">&middot; Harmony</HeaderLink>
					<HeaderLink href="/blacksmith">&middot; Blacksmith</HeaderLink>
				</div>
				<div class="mobile-section">
					<h3>Game-related</h3>
					<HeaderLink href="/portalmodpack">&middot; PortalMP</HeaderLink>
					<HeaderLink href="/bioshockmodpack">&middot; BioshockMP</HeaderLink>
				</div>
				<div class="mobile-section">
					<h3>Miscellaneous</h3>
					<HeaderLink href="/glowlichenfix">&middot; GlowLichenFix</HeaderLink>
					<HeaderLink href="/excalibur">&middot; Excalibur</HeaderLink>
				</div>
			</div>
			<div class="mobile-social-links">
				<ThemeToggle />
				<a href="https://ko-fi.com/ceilingash">
					<span class="sr-only">Ko-Fi</span>
					<svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32">
						<path fill="currentColor" d="M11.351 2.715c-2.7 0-4.986.025-6.83.26C2.078 3.285 0 5.154 0 8.61c0 3.506.182 6.13 1.585 8.493 1.584 2.701 4.233 4.182 7.662 4.182h.83c4.209 0 6.494-2.234 7.637-4a9.5 9.5 0 0 0 1.091-2.338C21.792 14.688 24 12.22 24 9.208v-.415c0-3.247-2.13-5.507-5.792-5.87-1.558-.156-2.65-.208-6.857-.208m0 1.947c4.208 0 5.09.052 6.571.182 2.624.311 4.13 1.584 4.13 4v.39c0 2.156-1.792 3.844-3.87 3.844h-.935l-.156.649c-.208 1.013-.597 1.818-1.039 2.546-.909 1.428-2.545 3.064-5.922 3.064h-.805c-2.571 0-4.831-.883-6.078-3.195-1.09-2-1.298-4.155-1.298-7.506 0-2.181.857-3.402 3.012-3.714 1.533-.233 3.559-.26 6.39-.26m6.547 2.287c-.416 0-.65.234-.65.546v2.935c0 .311.234.545.65.545 1.324 0 2.051-.754 2.051-2s-.727-2.026-2.052-2.026m-10.39.182c-1.818 0-3.013 1.48-3.013 3.142 0 1.533.858 2.857 1.949 3.897.727.701 1.87 1.429 2.649 1.896a1.47 1.47 0 0 0 1.507 0c.78-.467 1.922-1.195 2.623-1.896 1.117-1.039 1.974-2.364 1.974-3.897 0-1.662-1.247-3.142-3.039-3.142-1.065 0-1.792.545-2.338 1.298-.493-.753-1.246-1.298-2.312-1.298"/>
					</svg>
				</a>
				<a href="https://x.com/ceilingash">
					<span class="sr-only">X</span>
					<svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32">
						<path fill="currentColor" d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/>
					</svg>
				</a>
				<a href="https://modrinth.com/user/ceilingash">
					<span class="sr-only">Modrinth</span>
					<svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32">
						<path fill="currentColor" d="M12.252.004a11.78 11.768 0 0 0-8.92 3.73 11 10.999 0 0 0-2.17 3.11 11.37 11.359 0 0 0-1.16 5.169c0 1.42.17 2.5.6 3.77.24.759.77 1.899 1.17 2.529a12.3 12.298 0 0 0 8.85 5.639c.44.05 2.54.07 2.76.02.2-.04.22.1-.26-1.7l-.36-1.37-1.01-.06a8.5 8.489 0 0 1-5.18-1.8 5.34 5.34 0 0 1-1.3-1.26c0-.05.34-.28.74-.5a37.572 37.545 0 0 1 2.88-1.629c.03 0 .5.45 1.06.98l1 .97 2.07-.43 2.06-.43 1.47-1.47c.8-.8 1.48-1.5 1.48-1.52 0-.09-.42-1.63-.46-1.7-.04-.06-.2-.03-1.02.18-.53.13-1.2.3-1.45.4l-.48.15-.53.53-.53.53-.93.1-.93.07-.52-.5a2.7 2.7 0 0 1-.96-1.7l-.13-.6.43-.57c.68-.9.68-.9 1.46-1.1.4-.1.65-.2.83-.33.13-.099.65-.579 1.14-1.069l.9-.9-.7-.7-.7-.7-1.95.54c-1.07.3-1.96.53-1.97.53-.03 0-2.23 2.48-2.63 2.97l-.29.35.28 1.03c.16.56.3 1.16.31 1.34l.03.3-.34.23c-.37.23-2.22 1.3-2.84 1.63-.36.2-.37.2-.44.1-.08-.1-.23-.6-.32-1.03-.18-.86-.17-2.75.02-3.73a8.84 8.839 0 0 1 7.9-6.93c.43-.03.77-.08.78-.1.06-.17.5-2.999.47-3.039-.01-.02-.1-.02-.2-.03Zm3.68.67c-.2 0-.3.1-.37.38-.06.23-.46 2.42-.46 2.52 0 .04.1.11.22.16a8.51 8.499 0 0 1 2.99 2 8.38 8.379 0 0 1 2.16 3.449 6.9 6.9 0 0 1 .4 2.8c0 1.07 0 1.27-.1 1.73a9.37 9.369 0 0 1-1.76 3.769c-.32.4-.98 1.06-1.37 1.38-.38.32-1.54 1.1-1.7 1.14-.1.03-.1.06-.07.26.03.18.64 2.56.7 2.78l.06.06a12.07 12.058 0 0 0 7.27-9.4c.13-.77.13-2.58 0-3.4a11.96 11.948 0 0 0-5.73-8.578c-.7-.42-2.05-1.06-2.25-1.06Z"/>
					</svg>
				</a>
				<a href="https://linktr.ee/ceilingash">
					<span class="sr-only">Linktree</span>
					<svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32">
						<path fill="currentColor" d="m13.73635 5.85251 4.00467-4.11665 2.3248 2.3808-4.20064 4.00466h5.9085v3.30473h-5.9365l4.22865 4.10766-2.3248 2.3338L12.0005 12.099l-5.74052 5.76852-2.3248-2.3248 4.22864-4.10766h-5.9375V8.12132h5.9085L3.93417 4.11666l2.3248-2.3808 4.00468 4.11665V0h3.4727zm-3.4727 10.30614h3.4727V24h-3.4727z"/>
					</svg>
				</a>
			</div>
		</div>
	</div>
</header>

<script>
	document.addEventListener('DOMContentLoaded', function() {
		const mobileMenuBtn = document.getElementById('mobile-menu-btn');
		const mobileMenu = document.getElementById('mobile-menu');
		
		function toggleMobileMenu() {
			if (mobileMenu && mobileMenuBtn) {
				mobileMenu.classList.toggle('active');
				mobileMenuBtn.classList.toggle('open');
				if (mobileMenu.classList.contains('active')) {
					document.body.style.overflow = 'hidden';
				} else {
					document.body.style.overflow = '';
				}
			}
		}
		
		if (mobileMenuBtn) {
			mobileMenuBtn.addEventListener('click', toggleMobileMenu);
		}
		
		if (mobileMenu) {
			const mobileLinks = mobileMenu.querySelectorAll('a');
			mobileLinks.forEach(link => {
				link.addEventListener('click', () => {
					if (mobileMenu && mobileMenuBtn) {
						mobileMenu.classList.remove('active');
						mobileMenuBtn.classList.remove('open');
						document.body.style.overflow = '';
					}
				});
			});
		}

		const dropdowns = document.querySelectorAll('.dropdown');
		dropdowns.forEach(dropdown => {
			const button = dropdown.querySelector('.dropbtn');
			const content = dropdown.querySelector('.dropdown-content');
			
			if (button && content) {
				dropdown.addEventListener('mouseenter', () => button.setAttribute('aria-expanded', 'true'));
				dropdown.addEventListener('mouseleave', () => button.setAttribute('aria-expanded', 'false'));

				dropdown.addEventListener('focusin', () => button.setAttribute('aria-expanded', 'true'));
				dropdown.addEventListener('focusout', () => dropdown.matches(':focus-within') && button.setAttribute('aria-expanded', 'false'));
			}
		});
	});
</script>

<style>
	header {
		margin: 0;
		padding: 0 0.75em;
		background: var(--white);
		position: sticky;
		top: 0;
		z-index: 1001;
	}
	
	.header-title a {
		margin: 0.75em 0;
		padding: 0.25em 0.5em;
		font-size: 1em;
		display: inline-block;
		text-decoration: none;
		background-color: var(--black);
		color: var(--white);
	}

	.skip-link {
		position: fixed;
		top: -100%;
		z-index: 10;
		margin-inline: auto;
		font-family: "Press Start 2P", sans-serif;
		padding-inline: 1em;

		background-color: var(--accent);
		color: var(--white);

		&:focus {
			top: 0.25em;
		}
	}

	h2 {
		margin: 0;
		font-size: 1em;
	}

	h2 a,
	h2 a.active {
		text-decoration: none;
	}
	
	nav {
		display: flex;
		align-items: center;
		justify-content: space-between;
	}
	
	nav a {
		margin: 0.75em 0;
		padding: 0.25em 0.5em;
		font-size: 1em;
		color: var(--black);
		text-decoration: none;
		font-family: "Press Start 2P", sans-serif;
		line-height: 1.5;
		display: inline-block;
	}
	
	nav a:hover,
	nav a:focus,
	nav a.active {
		text-decoration: none;
		background-color: var(--accent);
		color: var(--white);
	}

	.internal-links {
		display: flex;
		flex-direction: row;
		align-items: center;
	}

	.social-links,
	.social-links a {
		display: flex;
	}

	.dropbtn {
		margin: 0.75em 0;
		padding: 0.25em 0.5em;
		border: none;
		font-size: 1em;
		color: var(--black);
		background-color: var(--white);
		text-decoration: none;
		font-family: "Press Start 2P", sans-serif;
		cursor: pointer;
		line-height: 1.5;
		display: inline-block;
		vertical-align: middle;
	}

	.dropbtn.active {
		background-color: var(--accent);
		color: var(--white);
	}

	.dropdown {
		position: relative;
		display: inline-block;
	}

	.dropdown-content {
		list-style-type: none;
		padding-left: 0;
		display: none;
		position: absolute;
		background-color: var(--white);
		width: 100%;
		top: calc(100% + -0.75em);
		left: 0;
		margin: 0;
		z-index: 1;
	}

	.dropdown-content a {
		display: block;
		padding: 0.25em 0.5em;
		margin: 0 !important;
	}

	.dropdown:hover .dropdown-content,
	.dropdown:focus-within .dropdown-content {
		display: block;
	}

	.dropdown:hover .dropbtn,
	.dropdown:focus-within .dropbtn {
		background-color: var(--accent);
		color: var(--white);
	}

	.mobile-menu-btn {
		display: none;
		flex-direction: column;
		justify-content: space-around;
		width: 2rem;
		height: 2rem;
		background: transparent;
		border: none;
		cursor: pointer;
		margin: 1em 0;
		padding: 0;
		user-select: none;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
	}

	.hamburger-line {
		width: 2rem;
		height: 0.25rem;
		background: var(--black);
		transition: all 0.3s ease;
		position: relative;
		transform-origin: center;
	}

	.mobile-menu-btn.open .hamburger-line:first-child {
		transform: translateY(0.68rem) rotate(45deg);
	}

	.mobile-menu-btn.open .hamburger-line:nth-child(2) {
		opacity: 0;
	}

	.mobile-menu-btn.open .hamburger-line:last-child {
		transform: translateY(-0.68rem) rotate(-45deg);
	}

	.mobile-menu {
		position: fixed;
		top: var(--header-height);
		left: 0;
		width: 100vw;
		height: calc(100vh - var(--header-height));
		background: var(--white);
		z-index: 1000;
		transform: translateX(100%);
		transition: transform 0.3s ease-in-out;
		overflow-y: auto;
	}

	.mobile-menu.active {
		transform: translateX(0);
	}

	.mobile-menu-content {
		height: 100%;
		display: flex;
		flex-direction: column;
	}

	.mobile-links {
		padding: 1em;
	}

	.mobile-section {
		margin-bottom: 2rem;
	}

	.mobile-section h3 {
		font-family: "Press Start 2P", sans-serif;
		font-size: 1.2rem;
		color: var(--black);
		margin-bottom: 1rem;
	}

	.mobile-section a {
		display: block;
		font-family: "Press Start 2P", sans-serif;
		font-size: 1rem;
		color: var(--black);
		text-decoration: none;
		padding: 0.75rem 0;
		margin: 0;
		line-height: 1.5;
	}

	.mobile-section a:hover,
	.mobile-section a:focus,
	.mobile-section a.active {
		background-color: var(--accent);
		color: var(--white);
		padding-left: 1rem;
	}

	.mobile-social-links {
		display: flex;
		justify-content: center;
		gap: 2rem;
		margin-bottom: 2rem;
		vertical-align: top;
	}

	.mobile-social-links a {
		display: flex;
		color: var(--black);
	}

	.mobile-social-links a:hover,
	.mobile-social-links a:focus {
		background-color: var(--accent);
		color: var(--white);
	}

	@media (min-width: 1131px) {
		.mobile-menu-btn {
			display: none;
		}
		
		.mobile-menu {
			display: none;
		}
	}

	@media (max-width: 1130px) {
		.social-links {
			display: none;
		}
		
		.desktop-nav {
			display: none;
		}
		
		.mobile-menu-btn {
			display: flex;
		}

		nav {
			justify-content: space-between;
		}
	}
</style>